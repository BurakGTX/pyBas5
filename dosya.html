<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GÃ¼venli Åifreli Pastebin</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: #f0f0f0; }
    textarea { width: 100%; height: 200px; font-family: monospace; font-size: 16px; }
    input, button { padding: 10px; margin: 10px 0; font-size: 16px; }
    #output { margin-top: 20px; background: white; padding: 20px; border: 1px solid #ccc; border-radius: 8px; }
    .info { color: #555; font-size: 0.9em; }
    code { background: #eee; padding: 2px 6px; border-radius: 4px; }
  </style>
  <!-- Crypto-JS iÃ§in CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
</head>
<body>
  <h1>ğŸ”’ GÃ¼venli Åifreli Pastebin</h1>
  <p>Metnini yaz, paste oluÅŸtur. Linkteki ÅŸifre ile sadece sen (veya paylaÅŸtÄ±ÄŸÄ±n kiÅŸi) okuyabilir!</p>

  <textarea id="content" placeholder="Buraya gizli metnini yaz..."></textarea><br>
  <button onclick="createPaste()">ğŸ” Paste OluÅŸtur (Åifrele)</button>

  <h2>Ya da Linkten AÃ§</h2>
  <p>PaylaÅŸÄ±lan linki buraya yapÄ±ÅŸtÄ±rÄ±p aÃ§abilirsin (otomatik Ã§Ã¶zÃ¼lÃ¼r).</p>

  <div id="output"></div>

  <!-- Firebase SDK v9 Compat -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAdYx6KnAiSY6mVtkLt_ZK1R0Rq3Uh1tRY",
      authDomain: "pastebin-61d0b.firebaseapp.com",
      projectId: "pastebin-61d0b",
      storageBucket: "pastebin-61d0b.appspot.com",
      messagingSenderId: "984614843816",
      appId: "1:984614843816:web:77260642b9b5903833999d"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Åifreleme fonksiyonu (AES)
    function encryptText(text, password) {
      return CryptoJS.AES.encrypt(text, password).toString();
    }

    function decryptText(encryptedText, password) {
      try {
        const bytes = CryptoJS.AES.decrypt(encryptedText, password);
        return bytes.toString(CryptoJS.enc.Utf8);
      } catch (e) {
        return null;
      }
    }

    async function createPaste() {
      const content = document.getElementById('content').value.trim();
      if (!content) return alert("Metin boÅŸ olamaz!");

      const pasteId = Math.random().toString(36).substring(2, 10);
      const password = CryptoJS.lib.WordArray.random(32).toString(); // GÃ¼Ã§lÃ¼ rastgele ÅŸifre

      const encrypted = encryptText(content, password);

      await db.collection("pastes").doc(pasteId).set({
        data: encrypted,
        created: new Date().toISOString()
      });

      const shareUrl = window.location.href.split('?')[0] + "?id=" + pasteId + "#" + password;

      document.getElementById('output').innerHTML = `
        <strong>âœ… Paste baÅŸarÄ±yla ÅŸifrelendi ve oluÅŸturuldu!</strong><br><br>
        <strong>PaylaÅŸÄ±labilir Link:</strong><br>
        <input type="text" value="${shareUrl}" readonly style="width:100%; padding:10px; font-size:14px;"><br><br>
        <p class="info">
          â€¢ Bu linkteki <code>#</code> sonrasÄ±ndaki kÄ±sÄ±m ÅŸifre anahtarÄ±dÄ±r.<br>
          â€¢ Linki paylaÅŸtÄ±ÄŸÄ±n kiÅŸi direkt okuyabilir (ÅŸifre otomatik alÄ±nÄ±r).<br>
          â€¢ Sunucuda sadece ÅŸifreli veri saklanÄ±r â†’ kimse okuyamaz!
        </p>
      `;
    }

    async function loadPaste() {
      const urlParams = new URLSearchParams(window.location.search);
      const pasteId = urlParams.get('id');
      if (!pasteId) return;

      const hash = window.location.hash.substring(1); // #sonrasÄ± ÅŸifre
      if (!hash) {
        document.getElementById('output').innerHTML = `<strong>âš ï¸ Åifre anahtarÄ± eksik!</strong> Link tam olmalÄ±: ?id=...#ÅŸifre`;
        return;
      }

      const doc = await db.collection("pastes").doc(pasteId).get();
      if (!doc.exists) {
        document.getElementById('output').innerHTML = "Paste bulunamadÄ±! ğŸ˜¢";
        return;
      }

      const encryptedData = doc.data().data;
      const decrypted = decryptText(encryptedData, hash);

      if (!decrypted) {
        document.getElementById('output').innerHTML = "<strong>âŒ YanlÄ±ÅŸ ÅŸifre veya bozuk veri!</strong>";
        return;
      }

      document.getElementById('output').innerHTML = `
        <strong>ğŸ”“ Metin baÅŸarÄ±yla Ã§Ã¶zÃ¼ldÃ¼!</strong><br>
        Tarih: ${new Date(doc.data().created).toLocaleString('tr-TR')}<br><br>
        <pre style="background:#f8f8f8; padding:15px; border-radius:8px; overflow:auto;">${decrypted}</pre>
      `;
    }

    // Sayfa yÃ¼klendiÄŸinde linkte id varsa otomatik aÃ§
    window.onload = loadPaste;
  </script>
</body>
</html>
