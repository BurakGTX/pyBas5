<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ”’ Ultra GÃ¼venli Åifreli Pastebin</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: #f0f0f0; }
    textarea { width: 100%; height: 200px; font-family: monospace; font-size: 16px; }
    input, button { padding: 12px; margin: 10px 0; font-size: 16px; width: 100%; box-sizing: border-box; }
    #output { margin-top: 20px; background: white; padding: 20px; border: 1px solid #ccc; border-radius: 8px; }
    .info { color: #555; font-size: 0.9em; background: #f9f9f9; padding: 10px; border-radius: 6px; }
    code { background: #eee; padding: 2px 6px; border-radius: 4px; }
    .warning { color: #d00; font-weight: bold; }
  </style>
  <!-- Crypto-JS (AES-GCM iÃ§in) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
</head>
<body>
  <h1>ğŸ”’ Ultra GÃ¼venli Åifreli Pastebin</h1>
  <p>Metnini yaz, ÅŸifreli paste oluÅŸtur. Sadece doÄŸru ÅŸifreyle aÃ§Ä±lÄ±r!</p>

  <textarea id="content" placeholder="Gizli metnini buraya yaz..."></textarea>

  <input type="password" id="userPassword" placeholder="Ä°steÄŸe baÄŸlÄ±: Kendi ÅŸifreni gir (boÅŸ bÄ±rakÄ±rsan otomatik gÃ¼Ã§lÃ¼ ÅŸifre Ã¼retilir)">

  <button onclick="createPaste()">ğŸ” Paste OluÅŸtur (Åifrele)</button>

  <h2>Linkten AÃ§</h2>
  <p>PaylaÅŸÄ±lan linki yeni sekmede aÃ§, otomatik Ã§Ã¶zÃ¼lÃ¼r.</p>

  <div id="output"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAdYx6KnAiSY6mVtkLt_ZK1R0Rq3Uh1tRY",
      authDomain: "pastebin-61d0b.firebaseapp.com",
      projectId: "pastebin-61d0b",
      storageBucket: "pastebin-61d0b.appspot.com",
      messagingSenderId: "984614843816",
      appId: "1:984614843816:web:77260642b9b5903833999d"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // GÃ¼Ã§lÃ¼ rastgele anahtar Ã¼ret (256 bit)
    function generateKey() {
      return CryptoJS.lib.WordArray.random(32); // 256 bit
    }

    // AES-256-GCM ile ÅŸifreleme (en gÃ¼venli mod)
    function encryptText(text, password) {
      const key = CryptoJS.PBKDF2(password, CryptoJS.enc.Hex.parse("73616c74"), { keySize: 8, iterations: 10000 });
      const iv = CryptoJS.lib.WordArray.random(12); // GCM iÃ§in 96-bit IV
      const encrypted = CryptoJS.AES.encrypt(text, key, { iv: iv, mode: CryptoJS.mode.GCM });
      return iv.concat(encrypted.ciphertext).toString(CryptoJS.enc.Base64);
    }

    // Ã‡Ã¶zme
    function decryptText(encryptedBase64, password) {
      try {
        const key = CryptoJS.PBKDF2(password, CryptoJS.enc.Hex.parse("73616c74"), { keySize: 8, iterations: 10000 });
        const encryptedData = CryptoJS.enc.Base64.parse(encryptedBase64);
        const iv = encryptedData.clone();
        iv.sigBytes = 12;
        iv.clamp();
        encryptedData.words.splice(0, 3); // IV'yi kaldÄ±r
        encryptedData.sigBytes -= 12;

        const decrypted = CryptoJS.AES.decrypt({ ciphertext: encryptedData }, key, {
          iv: iv,
          mode: CryptoJS.mode.GCM
        });
        return decrypted.toString(CryptoJS.enc.Utf8);
      } catch (e) {
        return null;
      }
    }

    async function createPaste() {
      const content = document.getElementById('content').value.trim();
      if (!content) return alert("Metin boÅŸ olamaz!");

      let password = document.getElementById('userPassword').value.trim();
      if (!password) {
        password = generateKey().toString(); // KullanÄ±cÄ± girmediyse gÃ¼Ã§lÃ¼ rastgele
      }

      const encrypted = encryptText(content, password);

      const pasteId = Math.random().toString(36).substring(2, 12); // Daha uzun ID (brute force zor)

      await db.collection("pastes").doc(pasteId).set({
        data: encrypted,
        created: firebase.firestore.FieldValue.serverTimestamp()
      });

      // Åifreyi URL'de gÃ¼venli ÅŸekilde taÅŸÄ±: base64 encode edip query param olarak
      const encodedKey = btoa(password);
      const shareUrl = window.location.href.split('?')[0] + "?id=" + pasteId + "&k=" + encodedKey;

      document.getElementById('output').innerHTML = `
        <strong>âœ… Paste ultra gÃ¼venli ÅŸekilde oluÅŸturuldu!</strong><br><br>
        <strong>PaylaÅŸÄ±labilir Link:</strong><br>
        <input type="text" value="${shareUrl}" readonly style="width:100%; padding:10px; font-size:14px;"><br><br>
        <div class="info">
          â€¢ Åifre <strong>${password ? 'senin girdiÄŸin' : 'otomatik gÃ¼Ã§lÃ¼ Ã¼retildi'}</strong>.<br>
          â€¢ Linkteki ÅŸifre <code>k=</code> kÄ±smÄ±nda kodlanmÄ±ÅŸ halde â†’ F12 console'da bile aÃ§Ä±kta deÄŸil.<br>
          â€¢ Sunucuda sadece ÅŸifreli veri var â†’ kimse okuyamaz!<br>
          â€¢ <span class="warning">Linki kimseyle paylaÅŸma riski sana ait!</span>
        </div>
      `;
    }

    async function loadPaste() {
      const urlParams = new URLSearchParams(window.location.search);
      const pasteId = urlParams.get('id');
      const encodedKey = urlParams.get('k');

      if (!pasteId || !encodedKey) {
        document.getElementById('output').innerHTML = `<strong>âš ï¸ GeÃ§ersiz link!</strong> Tam link gerekli: ?id=...&k=...`;
        return;
      }

      // Åifreyi decode et
      let password;
      try {
        password = atob(encodedKey);
      } catch (e) {
        document.getElementById('output').innerHTML = `<strong>âŒ Bozuk ÅŸifre anahtarÄ±!</strong>`;
        return;
      }

      const doc = await db.collection("pastes").doc(pasteId).get();
      if (!doc.exists) {
        document.getElementById('output').innerHTML = "Paste bulunamadÄ± veya silindi! ğŸ˜¢";
        return;
      }

      const encryptedData = doc.data().data;
      const decrypted = decryptText(encryptedData, password);

      if (!decrypted) {
        document.getElementById('output').innerHTML = "<strong>âŒ YanlÄ±ÅŸ ÅŸifre veya veri bozulmuÅŸ!</strong>";
        return;
      }

      const created = doc.data().created ? doc.data().created.toDate().toLocaleString('tr-TR') : "Bilinmiyor";

      document.getElementById('output').innerHTML = `
        <strong>ğŸ”“ Metin baÅŸarÄ±yla Ã§Ã¶zÃ¼ldÃ¼!</strong><br>
        OluÅŸturulma: ${created}<br><br>
        <pre style="background:#f8f8f8; padding:20px; border-radius:8px; overflow:auto; border:1px solid #ddd;">${decrypted}</pre>
      `;
    }

    // Sayfa aÃ§Ä±ldÄ±ÄŸÄ±nda otomatik yÃ¼kle
    window.onload = loadPaste;
  </script>
</body>
</html>
